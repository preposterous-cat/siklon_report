L.SvgObject=L.SVGOverlay.extend({options:{svgViewBox:{viewBox:!1,fitBounds:!1,scaleBounds:1}},initialize:function(t,e,s,i){this.uuid=s,(i=i||this.options).interactive=!0,this._svgViewBox=null;let n=(new DOMParser).parseFromString(t,"image/svg+xml").documentElement;if(i.svgViewBox&&("string"==typeof i.svgViewBox.viewBox||i.svgViewBox.viewBox instanceof String)){if("calculate"===i.svgViewBox.viewBox){document.body.appendChild(n);let t=n.getBBox();document.body.removeChild(n),this._svgViewBox=t.x.toString()+" "+t.y.toString()+" "+t.width.toString()+" "+t.height.toString()}else this._svgViewBox=i.svgViewBox.viewBox;let t=this._svgViewBox.split(" ");if(1==i.svgViewBox.fitBounds&&4==t.length){let s=L.latLng(0,0);s.lat=e._southWest.lat+(e._northEast.lat-e._southWest.lat)/2,s.lng=e._southWest.lng+(e._northEast.lng-e._southWest.lng)/2;let n=1;i.svgViewBox.scaleBounds&&(n=i.svgViewBox.scaleBounds),e=[[s.lat-t[3]/2*n,s.lng-t[2]/2*n],[s.lat+t[3]/2*n,s.lng+t[2]/2*n]]}i.svgViewBox.viewBox=this._svgViewBox}null==this._svgViewBox&&(this._svgViewBox="0 0 "+(e._northEast.lng-e._southWest.lng).toString()+" "+(e._northEast.lat-e._southWest.lat).toString()),n.setAttribute("viewBox",this._svgViewBox),L.SVGOverlay.prototype.initialize.call(this,n,e,i),this._latlng=this.getLatLng()},fitBounds:function(){let t=this.getLatLng(),e=this._svgViewBox.split(" ");4==e.length&&this.setBounds([[t.lat-e[3]/2,t.lng-e[2]/2],[t.lat+e[3]/2,t.lng+e[2]/2]])},setLatLng:function(t){let e=this._latlng,s=this.getBounds();return this.setBounds([[t.lat-(s._northEast.lat-s._southWest.lat)/2,t.lng-(s._northEast.lng-s._southWest.lng)/2],[t.lat+(s._northEast.lat-s._southWest.lat)/2,t.lng+(s._northEast.lng-s._southWest.lng)/2]]),this._latlng=this.getLatLng(),this.fire("move",{oldLatLng:e,latlng:this._latlng})},getLatLng:function(){let t=this.getBounds(),e=L.latLng(0,0);return e.lat=t._southWest.lat+(t._northEast.lat-t._southWest.lat)/2,e.lng=t._southWest.lng+(t._northEast.lng-t._southWest.lng)/2,this._latlng=e,this._latlng},redraw:function(){}}),L.Draw=L.Draw||{},L.drawLocal.draw.handlers.svg={tooltip:{start:"Add SVG."}},L.drawLocal.draw.toolbar.buttons.svg="Draw an svg",L.Draw.Svg=L.Draw.SimpleShape.extend({statics:{TYPE:"svg"},options:{shapeOptions:{clickable:!0}},initialize:function(t,e){this.type=L.Draw.Svg.TYPE,this._initialLabelText=L.drawLocal.draw.handlers.svg.tooltip.start,L.Draw.SimpleShape.prototype.initialize.call(this,t,e),this._template='<rect width="100" height="100" />',this._templateBounds=[[0,0],[100,100]],this._svgViewBox=!1,this._svgFitBounds=!1,this._scale=1},_fireCreatedEvent:function(){let t=(this._templateBounds[1][0]-this._templateBounds[0][0])/2,e=(this._templateBounds[1][1]-this._templateBounds[0][1])/2,s=new L.SvgObject('<svg xmlns="http://www.w3.org/2000/svg">'+this._template+"</svg>",L.latLngBounds([this._startLatLng.lat-t,this._startLatLng.lng-e],[this._startLatLng.lat+t,this._startLatLng.lng+e]),null,{svgViewBox:{viewBox:this._svgViewBox,fitBounds:this._svgFitBounds,scaleBounds:this._scale}});L.Draw.SimpleShape.prototype._fireCreatedEvent.call(this,s)},_onMouseMove:function(t){let e=t.latlng;if(this._tooltip.updatePosition(e),this._shape)this._shape.setLatLng(e);else{let t=(this._templateBounds[1][0]-this._templateBounds[0][0])/2,s=(this._templateBounds[1][1]-this._templateBounds[0][1])/2;this._shape=new L.SvgObject('<svg xmlns="http://www.w3.org/2000/svg">'+this._template+"</svg>",L.latLngBounds([e.lat-t,e.lng-s],[e.lat+t,e.lng+s]),null,{svgViewBox:{viewBox:this._svgViewBox,fitBounds:this._svgFitBounds,scaleBounds:this._scale}}),this._map.addLayer(this._shape)}this._tooltip.updateContent({text:this._endLabelText,subtext:""})}}),L.Edit=L.Edit||{},L.Edit.Svg=L.Edit.SimpleShape.extend({addHooks:function(){L.Edit.SimpleShape.prototype.addHooks.call(this);let t=this._shape._image;t.style.display="none",L.DomUtil.addClass(t,"leaflet-edit-svg-selected"),t.style.display=""},removeHooks:function(){let t=this._shape._image;t.style.display="none",L.DomUtil.removeClass(t,"leaflet-edit-svg-selected"),t.style.display="",L.Edit.SimpleShape.prototype.removeHooks.call(this)},_createMoveMarker:function(){let t=this._shape.getLatLng();this._moveMarker=this._createMarker(t,this.options.moveIcon)},_createResizeMarker:function(){this._resizeMarkers=[]},_move:function(t){if(this._resizeMarkers.length){let e=this._getResizeMarkerPoint(t);this._resizeMarkers[0].setLatLng(e)}this._shape.setLatLng(t),this._map.fire(L.Draw.Event.EDITMOVE,{layer:this._shape})}}),L.SvgObject.addInitHook(function(){L.Edit.Svg&&(this.editing=new L.Edit.Svg(this),this.options.editable&&this.editing.enable())}),L.DrawToolbar.include({options:{polyline:{},polygon:{},rectangle:{},circle:{},marker:{},circlemarker:{},svg:{}},getModeHandlers:function(t){return[{enabled:this.options.polyline,handler:new L.Draw.Polyline(t,this.options.polyline),title:L.drawLocal.draw.toolbar.buttons.polyline},{enabled:this.options.polygon,handler:new L.Draw.Polygon(t,this.options.polygon),title:L.drawLocal.draw.toolbar.buttons.polygon},{enabled:this.options.rectangle,handler:new L.Draw.Rectangle(t,this.options.rectangle),title:L.drawLocal.draw.toolbar.buttons.rectangle},{enabled:this.options.circle,handler:new L.Draw.Circle(t,this.options.circle),title:L.drawLocal.draw.toolbar.buttons.circle},{enabled:this.options.marker,handler:new L.Draw.Marker(t,this.options.marker),title:L.drawLocal.draw.toolbar.buttons.marker},{enabled:this.options.circlemarker,handler:new L.Draw.CircleMarker(t,this.options.circlemarker),title:L.drawLocal.draw.toolbar.buttons.circlemarker},{enabled:this.options.svg,handler:new L.Draw.Svg(t,this.options.svg),title:L.drawLocal.draw.toolbar.buttons.svg}]}}),L.EditToolbar.Edit.include({_backupLayer:function(t){let e=L.Util.stamp(t);this._uneditedLayerProps[e]||(t instanceof L.Polyline||t instanceof L.Polygon||t instanceof L.Rectangle?this._uneditedLayerProps[e]={latlngs:L.LatLngUtil.cloneLatLngs(t.getLatLngs())}:t instanceof L.Circle?this._uneditedLayerProps[e]={latlng:L.LatLngUtil.cloneLatLng(t.getLatLng()),radius:t.getRadius()}:t instanceof L.Marker||t instanceof L.CircleMarker?this._uneditedLayerProps[e]={latlng:L.LatLngUtil.cloneLatLng(t.getLatLng())}:t instanceof L.SvgObject&&(this._uneditedLayerProps[e]={bounds:t.getBounds()}))},_revertLayer:function(t){let e=L.Util.stamp(t);t.edited=!1,this._uneditedLayerProps.hasOwnProperty(e)&&(t instanceof L.Polyline||t instanceof L.Polygon||t instanceof L.Rectangle?t.setLatLngs(this._uneditedLayerProps[e].latlngs):t instanceof L.Circle?(t.setLatLng(this._uneditedLayerProps[e].latlng),t.setRadius(this._uneditedLayerProps[e].radius)):t instanceof L.Marker||t instanceof L.CircleMarker?t.setLatLng(this._uneditedLayerProps[e].latlng):t instanceof L.SVGOverlay&&t.setBounds(this._uneditedLayerProps[e].bounds),t.fire("revert-edited",{layer:t}))}});